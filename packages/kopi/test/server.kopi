generate, html, body, text = import "test/html.kopi"

template = message => generate (
  html () [
    body () [
      text "<p>This is a dynamic document</p>"
      text message
    ]
  ]
), 0

server = spawn () => {
  loop = (requests) => {
    request, _ = yield request => match request.url (
      "/favicon.ico" => ""
      "/"            => template ("[" ++ (string requests) ++ " requests] <a href='test.html'>Link to static document</a>")
       _             => read ("test/" ++ request.url)
    )

    loop (requests + 1)
  }

  loop 0
}

listen 8080 server

# print $ send server 1
# print $ send server 2
