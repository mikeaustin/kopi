generate, html, body, text = import "test/html.kopi"

template = message => generate (
  html () [
    body () [
      text message
    ]
  ]
), 0

server = spawn () => {
  loop = (x = 1) => {
    request, _ = yield request => match request.url (
      "/" => template ("Hello, world!" ++ " " ++ (string x))
       _  => (string 404)
    )

    match request.url (
      "/" => loop (x + 1)
       _  => loop x
    )
  }

  loop 1
}

listen server

# print $ send server 1
# print $ send server 2
